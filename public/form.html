<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>jQuery AJAX API request form</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
    #method {
        font-size: medium;
    }
    .method-get {
        color: #06780b;
    }
    .method-post {
        color: #b5733f;
    }
    .method-put {
        color: #065da2;
    }
    .method-delete {
        color: #9e160c;
    }
    .card {
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        transition: 0.3s;
        width: 100%;       
        height: 80vh;
        margin: 0 200px 0 -50px;
    }
    .card:hover {
      box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
    }
</style>
<script>
    $(document).ready(function() {
     $('#oauthForm').on('submit', function(event) {
        event.preventDefault(); 

        const clientId = $('#clientId').val();
        const clientSecret = $('#clientSecret').val();
        const credentials = clientId + ':' + clientSecret;
        const encodedCredentials = btoa(credentials);
        const tokenURL = $('#tokenURL').val();

        //Generate authentication headers
        const userId = '50';
        const nonce = Math.random().toString(36).substr(2, 10); // Random nonce
        const timestamp = Date.now(); // Current timestamp
        const signature = 'LhasLMKx+XoCGAQbwuRTXv7uGwMneuOtsNsDscgH2Lk='; 
        const authHeader = "user:" + userId + ";nonce:" + nonce + ";timestamp:" + timestamp + ";signature:" + signature
               
        
        const name = document.getElementById('apiUrl').value;
        const apiUrl = $('#apiUrl').val();
        const method = $('#method').val();
        const  headers = {            
                       'Authorization': 'Bearer ' + encodedCredentials, 
                      /* 'Authorization': 'Basic ' + encodedCredentials, */
                      'Content-Type': 'application/x-www-form-urlencoded',
                      'X-Planmill-Auth' : authHeader
                };
        const data = 'grant_type = client_credentials';

        if(!apiUrl) {
            alert('Please enter the API URL.')
        }
        

        // Make AJAX request with custom headers
        $.ajax({
            url: apiUrl,
            method: method,
            /* data: data, */
            dataType: 'json', 
            headers: headers,
            success: function(response) {
                alert('Request successful')
                console.log('response',response)
              $('#jsonOutput').text(JSON.stringify(response, null, 2));
            },
            error: function(jqXHR, textStatus, errorThrown) {
              console.error('AJAX error:', textStatus, errorThrown);
            }
        });
      });
        const $method = $('#method');
        function updateMethodStyle() {
            const method = $method.val().toLowerCase();
            $method.attr('class','method-' + method);
        }

        //Initialize style on page load
        updateMethodStyle();

        $method.change(updateMethodStyle);
    });
</script>
</head>
<body style="text-align:center; margin-top:100px; padding:70px;padding: 0 0 70px 100px;">
    <div class="card">
        <h1 style="padding-top: 10px;">PlanMill API TESTING TOOL</h1>
        <p>Welcome! You are authenticated.</p>
        <br> <br> <p>This tool help you to test and modify APIs</p>
        <form  style="display: flex; padding-left:120px;" id="oauthForm">
            <select id="method" name="method" required> 
                 <option value="GET" class="method-get">GET</option>
                 <option value="POST" class="method-post">POST</option>
                 <option value="PUT" class="method-put">PUT</option>
                 <option value="DELETE" class="method-delete">DELETE</option>
            </select><br>

            <input type="text" id="apiUrl" name="apiUrl" style="width: 60%; height: 24px;" required>
            &nbsp;
            <button type="submit" style="background-color:#1976D2 !important; color:#fff !important; width:8%; border-color:#1976D2; font-size:medium;">Send</button>
        </form>
        <h2 style="text-align: left !important;padding-left: 120px;">JSON Response:</h2>
        <pre id="jsonOutput" style="border:1px solid hashtag#ccc; padding:10px;"></pre>
        <br>
        <div style="text-align:right !important;margin-top: -400px !important;font-size: 20px;">
            <a href="/logout">Logout</a>
        </div>       
    </div>
    </body>
</html>